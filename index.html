<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Chess AI</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; padding: 20px; }
        #board { width: 400px; max-width: 95vw; border: 5px solid #333; }
        .info { background: #333; padding: 10px; margin-bottom: 10px; border-radius: 5px; text-align: center; }
    </style>
</head>
<body>

    <div class="info">
        <div id="status">Grandmaster AI: Level 3</div>
    </div>
    <div id="board"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();

        // 1. POSITION VALUES: The AI now knows the center is better than the corners
        var reverseArray = function(array) { return array.slice().reverse(); };
        var pawnEval = [ [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0], [1.0, 1.0, 2.0, 3.0, 3.0, 2.0, 1.0, 1.0], [0.5, 0.5, 1.0, 2.5, 2.5, 1.0, 0.5, 0.5], [0.0, 0.0, 0.0, 2.0, 2.0, 0.0, 0.0, 0.0], [0.5, -0.5, -1.0, 0.0, 0.0, -1.0, -0.5, 0.5], [0.5, 1.0, 1.0, -2.0, -2.0, 1.0, 1.0, 0.5], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0] ];
        var knightEval = [ [-5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0], [-4.0, -2.0, 0.0, 0.0, 0.0, 0.0, -2.0, -4.0], [-3.0, 0.0, 1.0, 1.5, 1.5, 1.0, 0.0, -3.0], [-3.0, 0.5, 1.5, 2.0, 2.0, 1.5, 0.5, -3.0], [-3.0, 0.0, 1.5, 2.0, 2.0, 1.5, 0.0, -3.0], [-3.0, 0.5, 1.0, 1.5, 1.5, 1.0, 0.5, -3.0], [-4.0, -2.0, 0.0, 0.5, 0.5, 0.0, -2.0, -4.0], [-5.0, -4.0, -3.0, -3.0, -3.0, -3.0, -4.0, -5.0] ];

        function getPieceValue(piece, x, y) {
            if (piece === null) return 0;
            var getAbsoluteValue = function (piece, isWhite, x, y) {
                if (piece.type === 'p') return 10 + (isWhite ? pawnEval[y][x] : reverseArray(pawnEval)[y][x]);
                if (piece.type === 'r') return 50;
                if (piece.type === 'n') return 30 + knightEval[y][x];
                if (piece.type === 'b') return 30;
                if (piece.type === 'q') return 90;
                if (piece.type === 'k') return 900;
                return 0;
            };
            var absoluteValue = getAbsoluteValue(piece, piece.color === 'w', x, y);
            return piece.color === 'w' ? absoluteValue : -absoluteValue;
        }

        function evaluateBoard(game) {
            var totalEvaluation = 0;
            for (var i = 0; i < 8; i++) {
                for (var j = 0; j < 8; j++) {
                    totalEvaluation = totalEvaluation + getPieceValue(game.board()[i][j], i, j);
                }
            }
            return totalEvaluation;
        }

        // 2. THE SEARCH (MINIMAX): The AI now looks 3 moves deep into the future
        var minimax = function (depth, game, isMaximisingPlayer) {
            if (depth === 0) return -evaluateBoard(game);
            var newGameMoves = game.moves();
            if (isMaximisingPlayer) {
                var bestValue = -9999;
                for (var i = 0; i < newGameMoves.length; i++) {
                    game.move(newGameMoves[i]);
                    bestValue = Math.max(bestValue, minimax(depth - 1, game, !isMaximisingPlayer));
                    game.undo();
                }
                return bestValue;
            } else {
                var bestValue = 9999;
                for (var i = 0; i < newGameMoves.length; i++) {
                    game.move(newGameMoves[i]);
                    bestValue = Math.min(bestValue, minimax(depth - 1, game, !isMaximisingPlayer));
                    game.undo();
                }
                return bestValue;
            }
        };

        function makeBestMove() {
            var possibleMoves = game.moves();
            if (game.game_over()) return;

            var bestMove = null;
            var bestValue = -9999;

            for (var i = 0; i < possibleMoves.length; i++) {
                game.move(possibleMoves[i]);
                var boardValue = minimax(2, game, false); // "2" means looking ahead
                game.undo();
                if (boardValue > bestValue) {
                    bestValue = boardValue;
                    bestMove = possibleMoves[i];
                }
            }

            game.move(bestMove);
            board.position(game.fen());
        }

        function onDrop(source, target) {
            var move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';
            window.setTimeout(makeBestMove, 250);
        }

        board = Chessboard('board', { draggable: true, position: 'start', onDrop: onDrop });
    </script>
</body>
</html>
